/*!
* Copyright (c) 2015 Carrot Creative
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/(function(e,t){function n(){function a(e){var t=[];return e=(new String(e)).replace(n,function(e){return t.push(parseFloat(e)),r}),[e,t]}function f(e,t,n){var r=0,s,o;return e[0].replace(i,function(){return from=e[1][r],to=t[1][r],r++,from+(to-from)*n})}function m(n){var r;return v||(v="|"+Array.prototype.slice.call(e.getComputedStyle(t.documentElement,"")).join("|")+"|"),d[n]?d[n]:(r=(new RegExp("\\|(-(moz|webkit|ms)-"+n+")\\|")).exec(v))?d[n]=r[1]:n}function g(e,t,n){if(e instanceof NodeList||e instanceof Array)for(var r=0;r<e.length;r++)g(e[r],t,n);else e.style[m(t)]=n}function w(t){return function(){var n=e.pageYOffset;t.set(n)}}function E(n){return function(){g(t.body,"minHeight",n.max+e.innerHeight+"px")}}function S(t,n,r){var i=n.split(" "),s;for(var o=0;o<i.length;o++)s=i[o],t.events[s]||(t.events[s]=[]),t.events[s].push(r),e.addEventListener(s,r);r()}function x(t,n){var r=n.split(" "),i,s,o;for(var u=0;u<r.length;u++){i=r[u],s=t.events[i];for(var a=0;u<s.length;u++)o=s[a],e.removeEventListener(i,o);t.events[i]=[]}}function T(e){for(var t in e.events)x(e,t);e.events={}}var n=/[\-+]?[\d]*\.?[\d]+/g,r="{?}",i=/\{\?\}/g,s=function(e){var t=[],n=e.points,r,i;for(var s=0;s<n.length;s++)r=n[s],i=n[s+1],t.push(new u(e.property,r,i));this.tweens=t};s.prototype={current:function(e){var t=this.tweens,n=t.length,r,i;for(var s=0;s<n;s++){r=t[s];if(e>=r.fromY||e<=r.fromY&&s==0)i=r.current(e)}return i}};var o={};o.default=function(e,t){this.fromValue=a(e),this.toValue=a(t)},o.default.prototype={tween:function(e){var t=this.fromValue,n=this.toValue;return f(t,n,e)}};var u=function(e,t,n){n||(n=t),this.tweener=new(o[e]||o.default)(t.value,n.value),this.fromY=t.Y,this.toY=n.Y};u.prototype={current:function(e){var t=0,n=this.fromY,r=this.toY;return e>=n&&e<=r?t=(e-n)/(r-n):e>r&&(t=1),this.tweener.tween(t)}};var l=function(e){this.points=e.points};l.prototype={current:function(e){var t=this.points,n=new String;for(var r=0;r<t.length;r++)point=t[r],e>=point.Y&&(n=point.value);return n}};var c=function(e,t){this.Y=e,this.value=t},h=function(e){e=e||{},this.points=[];for(var t in e)this.add(t,e[t])};h.prototype={add:function(e,t){var n=this.points.slice(0),r=new c(parseInt(e),t),i=!1;for(var s=0;s<this.points.length;s++)this.points[s].Y>r.Y&&(n.splice(s,0,r),i=!0);return i||n.push(r),this.points=n,this},merge:function(e,t){var n=t.points,r;for(var i=0;i<n.length;i++)action=n[i],this.add(e+action.Y,action.value);return this}};var p=function(e,t,n){var n=this.points=(new h(n)).points;this.max=n[n.length-1].Y,this.property=t,this.klass=new e(this)};p.prototype={current:function(e){return this.klass.current(e)}};var d={},v,y=function(e){this.selector=e,this.actions={}};y.prototype={$:function(){var e=this.selector;return e.nodeName?e=[e]:"string"==typeof e&&(e=t.querySelectorAll(e)),e},add:function(e,t){var n=t.property,r;return(r=this.actions[n])||(r=new h),r.add(e,t),this.actions[n]=r,this},set:function(e){var t=this.$(),n=this.actions,r,i,s,o,u;for(var a in n){r=n[a],i=r.points;for(var f=0;f<i.length;f++)s=i[f],o=s.value,u=e-s.Y,(u>0||u<0&&f==0)&&g(t,a,o.current(u))}return this},unset:function(){var e=this.actions,t=this.$();for(var n in e)for(var r=0;r<t.length;r++)t[r].style[n]="";return this}};var b=function(){this.elements=[],this.max=0};b.prototype={add:function(e,t,n){var r=this.elements,i,s;for(var o=0;o<r.length;o++)if(r[o].selector==t){i=r[o];break}return i||(i=new y(t),r.push(i)),n&&(i.add(e,n),s=e+n.max,s>this.max&&(this.max=s)),this.elements=r,this},merge:function(e,t){var n=t.elements,r,i,s,o,u;for(var a=0;a<n.length;a++){r=n[a],i=r.actions;for(var f in i){s=i[f],o=s.points;for(var l=0;l<o.length;l++)u=o[l],this.add(parseInt(e)+u.Y,r.selector,u.value)}}return this},set:function(e){var t=this.elements,n;for(var r=0;r<t.length;r++)n=t[r],n.set(e)},unset:function(){var e=this.elements,t;for(var n=0;n<e.length;n++)t=e[n],t.unset()}};var N=function(){this.scenes={},this.ats={},this.events={}};N.prototype={add:function(e,t){if("function"==typeof t){var n=t;t=new C,n(t)}return this.scenes[e]=t,this},at:function(e,t){var n=this.ats[e]||[];return n.push(t),this.ats[e]=n,this},init:function(){var e,t,n;e=this.storyboard=new b;for(var r in this.ats){t=this.ats[r];for(var i=0;i<t.length;i++)n="string"==typeof t[i]?this.scenes[t[i]]:t[i],e.merge(r,n.storyboard)}return this.bind(),this},remove:function(){var e;if(e=this.storyboard)e.unset(),this.storyboard=null;return g(t.body,"minHeight",""),this.unbind(),this},bind:function(){return this.storyboard&&(S(this,"scroll resize",w(this.storyboard)),S(this,"resize",E(this.storyboard))),this},unbind:function(){return T(this),this}};var C=N.Scene=function(){this.storyboard=new b};return C.prototype={animate:function(e,t,n){return this.action(s,e,t,n)},style:function(e,t,n){return this.action(l,e,t,n)},action:function(e,t,n,r){var i;"undefined"==typeof r?i=n:(i={})[n]=r;for(n in i)action=new p(e,n,i[n]),this.storyboard.add(0,t,action);return this}},N}"function"==typeof define&&define.amd?define(n):e.Roll=n()})(window,document);