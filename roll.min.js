/*!
* Copyright (c) 2015 Carrot Creative
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/(function(e,t){function n(){function f(e){var t=[];return e=(new String(e)).replace(n,function(e){return t.push(parseFloat(e)),r}),[e,t]}function l(e,t,n){var r=0,i,o;return e[0].replace(s,function(){return from=e[1][r],to=t[1][r],r++,from+(to-from)*n})}function g(n){var r;return m||(m="|"+Array.prototype.slice.call(e.getComputedStyle(t.documentElement,"")).join("|")+"|"),v[n]?v[n]:(r=(new RegExp("\\|(-(moz|webkit|ms)-"+n+")\\|")).exec(m))?v[n]=r[1]:n}function y(e,t,n){if(e instanceof NodeList||e instanceof Array)for(var r=0;r<e.length;r++)y(e[r],t,n);else e.style[g(t)]=n}function E(t,n,r){var i=r.bind(null,t),s;for(var o=0;o<n.length;o++)s=n[o],t.events[s]||(t.events[s]=[]),t.events[s].push(i),e.addEventListener(s,i);i()}function S(t,n,r){var s,o,u;for(var a=0;a<n.length;a++){s=n[i],o="function"==typeof r?[r]:t.events[s];if(t.events[s])for(var f=0;f<o.length;f++)u=o[f],e.removeEventListener(s,u)}}function x(t){t.storyboard.set(e.pageYOffset)}function T(n){y(t.body,"minHeight",n.storyboard.max+e.innerHeight+"px")}var n=/[\-+]?[\d]*\.?[\d]+/g,r="{?}",s=/\{\?\}/g,o=function(e){var t=[],n=e.points,r,i;for(var s=0;s<n.length;s++)r=n[s],i=n[s+1],t.push(new a(e.property,r,i));this.tweens=t};o.prototype={current:function(e){var t=this.tweens,n=t.length,r,i;for(var s=0;s<n;s++){r=t[s];if(e>=r.fromY||e<=r.fromY&&s==0)i=r.current(e)}return i}};var u={};u.default=function(e,t){this.fromValue=f(e),this.toValue=f(t)},u.default.prototype={tween:function(e){var t=this.fromValue,n=this.toValue;return l(t,n,e)}};var a=function(e,t,n){n||(n=t),this.tweener=new(u[e]||u.default)(t.value,n.value),this.fromY=t.Y,this.toY=n.Y};a.prototype={current:function(e){var t=0,n=this.fromY,r=this.toY;return e>=n&&e<=r?t=(e-n)/(r-n):e>r&&(t=1),this.tweener.tween(t)}};var c=function(e){this.points=e.points};c.prototype={current:function(e){var t=this.points,n=new String;for(var r=0;r<t.length;r++)point=t[r],e>=point.Y&&(n=point.value);return n}};var h=function(e,t){this.Y=e,this.value=t},p=function(e){e=e||{},this.points=[];for(var t in e)this.add(t,e[t])};p.prototype={add:function(e,t){var n=this.points.slice(0),r=new h(parseInt(e),t),i=!1;for(var s=0;s<this.points.length;s++)this.points[s].Y>r.Y&&(n.splice(s,0,r),i=!0);return i||n.push(r),this.points=n,this},merge:function(e,t){var n=t.points,r;for(var i=0;i<n.length;i++)action=n[i],this.add(e+action.Y,action.value);return this}};var d=function(e,t,n){var n=this.points=(new p(n)).points;this.max=n[n.length-1].Y,this.property=t,this.klass=new e(this)};d.prototype={current:function(e){return this.klass.current(e)}};var v={},m,b=function(e){this.selector=e,this.actions={}};b.prototype={$:function(){var e=this.selector;return e.nodeName?e=[e]:"string"==typeof e&&(e=t.querySelectorAll(e)),e},add:function(e,t){var n=t.property,r;return(r=this.actions[n])||(r=new p),r.add(e,t),this.actions[n]=r,this},set:function(e){var t=this.$(),n=this.actions,r,i,s,o,u;for(var a in n){r=n[a],i=r.points;for(var f=0;f<i.length;f++)s=i[f],o=s.value,u=e-s.Y,(u>0||u<0&&f==0)&&y(t,a,o.current(u))}return this},unset:function(){var e=this.actions,t=this.$();for(var n in e)for(var r=0;r<t.length;r++)t[r].style[n]="";return this}};var w=function(){this.elements=[],this.max=0};w.prototype={add:function(e,t,n){var r=this.elements,i,s;for(var o=0;o<r.length;o++)if(r[o].selector==t){i=r[o];break}return i||(i=new b(t),r.push(i)),n&&(i.add(e,n),s=e+n.max,s>this.max&&(this.max=s)),this.elements=r,this},merge:function(e,t){var n=t.elements,r,i,s,o,u;for(var a=0;a<n.length;a++){r=n[a],i=r.actions;for(var f in i){s=i[f],o=s.points;for(var l=0;l<o.length;l++)u=o[l],this.add(parseInt(e)+u.Y,r.selector,u.value)}}return this},set:function(e){var t=this.elements,n;for(var r=0;r<t.length;r++)n=t[r],n.set(e)},unset:function(){var e=this.elements,t;for(var n=0;n<e.length;n++)t=e[n],t.unset()}};var N=function(){this.scenes={},this.ats={},this.events={}};N.prototype={add:function(e,t){if("function"==typeof t){var n=t;t=new C,n(t)}return this.scenes[e]=t,this},at:function(e,t){var n=this.ats[e]||[];return n.push(t),this.ats[e]=n,this},init:function(){var e,t,n;e=this.storyboard=new w;for(var r in this.ats){t=this.ats[r];for(var i=0;i<t.length;i++)n="string"==typeof t[i]?this.scenes[t[i]]:t[i],e.merge(r,n.storyboard)}return this.bind(),this},remove:function(){var e;if(e=this.storyboard)e.unset(),this.storyboard=null;return y(t.body,"minHeight",""),this.unbind(),this},bind:function(){return this.storyboard&&(E(this,["scroll","resize"],x),E(this,["resize"],T)),this},unbind:function(){return RemoveAllEvents(this),this}};var C=N.Scene=function(){this.storyboard=new w};return C.prototype={animate:function(e,t,n){return this.action(o,e,t,n)},style:function(e,t,n){return this.action(c,e,t,n)},action:function(e,t,n,r){var i;"undefined"==typeof r?i=n:(i={})[n]=r;for(n in i)action=new d(e,n,i[n]),this.storyboard.add(0,t,action);return this}},N}"function"==typeof define&&define.amd?define(n):e.Roll=n()})(window,document);