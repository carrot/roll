/*!
* Copyright (c) 2015 Carrot Creative
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/(function(e,t){function n(){function a(e){var t=[];return e=(new String(e)).replace(n,function(e){return t.push(parseFloat(e)),r}),[e,t]}function f(e,t,n){var r=0,s,o;return e[0].replace(i,function(){return from=e[1][r],to=t[1][r],r++,from+(to-from)*n})}var n=/[\-+]?[\d]*\.?[\d]+/g,r="{?}",i=/\{\?\}/g,s=function(e){var t=[],n=e.points,r,i;for(var s=0;s<n.length;s++)r=n[s],i=n[s+1],t.push(new u(e.property,r,i));this.tweens=t};s.prototype={current:function(e){var t=this.tweens,n=t.length,r,i;for(var s=0;s<n;s++){r=t[s];if(e>=r.fromY||e<=r.fromY&&s==0)i=r.current(e)}return i}};var o={};o.default=function(e,t){this.fromValue=a(e),this.toValue=a(t)},o.default.prototype={tween:function(e){var t=this.fromValue,n=this.toValue;return f(t,n,e)}};var u=function(e,t,n){n||(n=t),this.tweener=new(o[e]||o.default)(t.value,n.value),this.fromY=t.Y,this.toY=n.Y};u.prototype={current:function(e){var t=0,n=this.fromY,r=this.toY;return e>=n&&e<=r?t=(e-n)/(r-n):e>r&&(t=1),this.tweener.tween(t)}};var l=function(e){this.points=e.points};l.prototype={current:function(e){var t=this.points,n=new String;for(var r=0;r<t.length;r++)point=t[r],e>=point.Y&&(n=point.value);return n}};var c=function(e,t){this.Y=e,this.value=t},h=function(e){e=e||{},this.points=[];for(var t in e)this.add(t,e[t])};h.prototype={add:function(e,t){var n=this.points.slice(0),r=new c(parseInt(e),t),i=!1;for(var s=0;s<this.points.length;s++)this.points[s].Y>r.Y&&(n.splice(s,0,r),i=!0);return i||n.push(r),this.points=n,this},merge:function(e,t){var n=t.points,r;for(var i=0;i<n.length;i++)action=n[i],this.add(e+action.Y,action.value);return this}};var p=function(e,t,n){var n=this.points=(new h(n)).points;this.max=n[n.length-1].Y,this.property=t,this.klass=new e(this)};p.prototype={current:function(e){return this.klass.current(e)}};var d=function(e){this.selector=e,this.collection=new h};d.prototype={add:function(e,t){return this.collection.add(e,t),this},set:function(e){var n=this.selector,r=this.collection,i=r.points,s,o,u;n.nodeName?n=[n]:"string"==typeof n&&(n=t.querySelectorAll(n));for(var a=0;a<i.length;a++){s=i[a],o=s.value,u=e-s.Y;if(u>0||u<0&&a==0)for(var f=0;f<n.length;f++)n[f].style[o.property]=o.current(u)}return this}};var v=function(){this.elements=[],this.max=0};v.prototype={add:function(e,t,n){var r=this.elements,i,s;for(var o=0;o<r.length;o++)if(r[o].selector==e){i=r[o];break}return i||(i=new d(e),r.push(i)),n&&(i.add(t,n),s=t+n.max,s>this.max&&(this.max=s)),this.elements=r,this},merge:function(e,t){var n=t.elements,r,i,s;for(var o=0;o<n.length;o++){r=n[o],i=r.collection,s=i.points;for(var u=0;u<s.length;u++)point=s[u],this.add(r.selector,point.Y+parseInt(e),point.value)}return this}};var m=function(t){return function(){var n=e.pageYOffset,r=t.elements,i;for(var s=0;s<r.length;s++)i=r[s],i.set(n)}},g=function(n){return function(){t.body.style.minHeight=n.max+e.innerHeight+"px"}},y=function(){this.scenes={},this.ats={},this.befores={},this.afters={}};y.prototype={add:function(e,t){if("function"==typeof t){var n=t;t=new b,n(t)}return this.scenes[e]=t,this},at:function(e,t){var n=this.ats[e]||[];return n.push(t),this.ats[e]=n,this},before:function(e,t){var n=this.befores[e]||[];return n.push(t),this.befores[e]=n,this},after:function(e,t){var n=this.afters[e]||[];return n.push(t),this.afters[e]=n,this},bind:function(){var t=this.scenes,n=new v,r,i,s,o,u;for(o in this.ats){u=parseInt(o),r=this.ats[o],i=t[r];for(var a in this.befores)a==r&&(s=t[this.befores[a]],n.merge(u-s.storyboard.max,s.storyboard));for(var f in this.afters)f==r&&(s=t[this.afters[f]],n.merge(u+i.storyboard.max,s.storyboard));n.merge(o,i.storyboard)}var l=m(n),c=g(n);e.addEventListener("scroll",l),e.addEventListener("resize",c),l(),c()}};var b=y.Scene=function(){this.storyboard=new v};return b.prototype={animate:function(e,t,n){return this.action(s,e,t,n)},style:function(e,t,n){return this.action(l,e,t,n)},action:function(e,t,n,r){var i;"undefined"==typeof r?i=n:(i={})[n]=r;for(n in i)action=new p(e,n,i[n]),this.storyboard.add(t,0,action);return this}},y}"function"==typeof define&&define.amd?define(n):e.Roll=n()})(window,document);